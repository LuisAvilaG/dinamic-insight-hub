# Sync Module Documentation

## Flujo de Trabajo: "Agregar Nueva Sincronizaci贸n"

### Paso 1: Conexi贸n y Alcance (El "Plug" )
*   **Nombre de la Sincronizaci贸n:** El usuario le da un nombre 煤nico al flujo.
*   **Autenticaci贸n y Selecci贸n:** Se conecta a ClickUp y elige Workspace/Espacio.
*   **Modo de Sincronizaci贸n:**
    *   **Interruptor [ Sincronizaci贸n Completa ]:**
        *   **Activado:** El usuario quiere todos los datos sin configurar. Se saltan los pasos de mapeo y se va directamente al Paso 3.
        *   **Desactivado (Modo Personalizado):** El usuario quiere elegir qu茅 datos sincronizar. Se avanza al Paso 2.

### Paso 2: Configuraci贸n de Datos (El "Play" 锔)
*Este paso solo se muestra si la "Sincronizaci贸n Completa" est谩 desactivada.*
*   **Modo de Configuraci贸n:** Detecci贸n autom谩tica de plantillas (con opci贸n de modo manual) y reorganizaci贸n con bot贸n de "Mover".
*   **Sincronizaci贸n de Registros de Tiempo:** Interruptor para activar la extracci贸n de registros de tiempo.

### Paso 3: Destino y Programaci贸n (La Ejecuci贸n )

**A. Consideraciones sobre la Base de Datos (Destino)**

El sistema crea y gestiona tablas de forma din谩mica en un esquema dedicado `clickup_data` cuando el usuario guarda la sincronizaci贸n.

*   **Paso 1: Capturar la Configuraci贸n:** El sistema guarda un JSON con la configuraci贸n del usuario, incluyendo los campos seleccionados y sus tipos de ClickUp. Para una **Sincronizaci贸n Completa**, el sistema inspecciona todas las listas del Espacio, crea un "superconjunto" de todos los campos 煤nicos encontrados y lo usa como plantilla universal.

*   **Paso 2: Traductor de Tipos:** Una l贸gica interna convierte los tipos de ClickUp a tipos de columna de PostgreSQL.
    *   `text`, `string` -> `TEXT`
    *   `dropdown`, `email` -> `VARCHAR(255)`
    *   `number`, `money` -> `NUMERIC`
    *   `date` -> `TIMESTAMPTZ`
    *   `checkbox` -> `BOOLEAN`
    *   `labels`, `users` -> `JSONB`

*   **Paso 3: Generaci贸n de SQL (`CREATE` vs `ALTER`):**
    *   **Si la tabla no existe:** Se genera y ejecuta un comando `CREATE TABLE` en el esquema `clickup_data`. Se a帽aden columnas de sistema como `clickup_task_id` (PRIMARY KEY) y `last_synced_at`.
    *   **Si la tabla ya existe (al editar):** El sistema la inspecciona y genera comandos `ALTER TABLE ... ADD COLUMN` para los nuevos campos. Los campos eliminados de la configuraci贸n se dejan intactos en la tabla para no perder datos hist贸ricos, pero ya no recibir谩n actualizaciones.

**B. Configuraci贸n de la Sincronizaci贸n (Cron Job)**

*   **Frecuencia:** Un men煤 desplegable para elegir la periodicidad (cada hora, diariamente, etc.).
*   **Modo de Sincronizaci贸n:**
    *   **Reemplazo Completo:** Borra todos los datos de la tabla y los carga de nuevo en cada ejecuci贸n.
    *   **Incremental (Recomendado):** Solo sincroniza tareas nuevas o modificadas desde la 煤ltima ejecuci贸n.
